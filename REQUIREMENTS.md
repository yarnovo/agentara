# Agentara 项目需求文档

## 项目概述

Agentara 是一个用于生成 AI Agent 的框架，通过定义标准化的 DSL（领域特定语言）来规范 AI Agent 的输出格式和行为。

## 核心需求

### 1. AI Agent 生成框架
- **目标**：通过 AI 自动生成符合特定规范的 Agent
- **挑战**：需要确保 AI 生成的 Agent 符合预定义的标准和格式
- **解决方案**：使用 DSL 定义 Agent 的规范，确保输出的一致性和规范性

### 2. DSL 定义与实现
- **技术选型**：使用 [textX](https://github.com/textX/textX) 库来定义 Agent DSL
- **选择理由**：
  - 语法定义清晰直观
  - 错误提示规则明确，对 AI 友好
  - 解析能力强大，易于扩展
  - 提供完善的错误定位和提示机制

### 3. Agent DSL 设计要求
- **语法清晰性**：DSL 语法必须简洁易懂，让 AI 能够准确理解和生成
- **错误处理**：当 AI 生成的内容不符合 DSL 规范时，能够提供明确的错误提示
- **可扩展性**：DSL 设计应支持未来的功能扩展
- **标准化输出**：确保所有生成的 Agent 都符合统一的格式标准

## 功能需求

### 1. DSL 语法定义
- 定义 Agent 的基本结构
- 定义 Agent 的属性和行为
- 定义 Agent 之间的交互规则
- 支持模块化和组合

### 2. 解析器实现
- 基于 textX 实现 DSL 解析器
- 提供语法验证功能
- 生成结构化的 Agent 定义

### 3. AI 生成集成
- 为 AI 提供清晰的 DSL 规范文档
- 实现 AI 生成结果的验证机制
- 提供错误反馈和修正建议

### 4. 工具链支持
- 命令行工具用于验证 DSL 文件
- 代码生成器将 DSL 转换为可执行代码
- 文档生成器自动生成 Agent 文档

## 技术架构

### 核心组件
1. **DSL 定义模块**：使用 textX 语法定义 Agent DSL
   - 语法文件：`agentara/grammar/agent.tx`
   - 支持 Agent、Capability、Parameter、Rule、Workflow 等概念

2. **解析器模块**：基于 textX 的解析器实现
   - 实现：`agentara/parser.py`
   - 支持语法解析和基础验证
   - 集成处理器自动注册

3. **验证器模块**：验证生成内容的合规性
   - 实现：`agentara/validator.py`
   - 支持自定义验证规则注册
   - 提供语义级别的验证

4. **注册器模块**：管理验证器和处理器
   - 实现：`agentara/registry.py`
   - 支持装饰器模式注册
   - 提供全局注册表管理

5. **加载器模块**：文件和字符串加载支持
   - 实现：`agentara/loader.py`
   - 支持多种输入源
   - 集成解析和验证流程

### 技术栈
- Python 3.12+
- textX 3.0+ （核心依赖）
- pytest（测试框架）
- pyright（类型检查）
- ruff（代码质量检查）

## 项目目标

1. **短期目标**：
   - 完成基础 DSL 语法定义
   - 实现基本的解析和验证功能
   - 创建示例 Agent 定义

2. **中期目标**：
   - 完善 DSL 功能，支持更复杂的 Agent 定义
   - 优化 AI 生成的准确性
   - 建立完整的工具链

3. **长期目标**：
   - 构建 Agent 生态系统
   - 支持多种 AI 模型
   - 提供可视化 Agent 设计工具

## 实现细节

### DSL 语法特性
1. **基础结构**：
   - Agent 定义：包含名称、描述、版本等属性
   - Capability 定义：支持参数化能力
   - Parameter 定义：支持必需参数标记
   - Rule 定义：支持函数调用和速率限制

2. **高级特性**：
   - 工作流支持：定义多个 Agent 的协作
   - 引用验证：自动验证 Agent 引用的有效性
   - 注释支持：支持单行注释

3. **错误处理**：
   - 语法错误：精确的行列定位
   - 语义错误：清晰的错误描述
   - 自定义错误：支持业务级别的验证错误

### 已实现功能
- ✅ 完整的 DSL 语法定义
- ✅ 基于 textX 的解析器
- ✅ 语义验证器框架
- ✅ 自定义验证规则支持
- ✅ 模型处理器支持
- ✅ 文件和字符串加载
- ✅ 完整的测试覆盖（60个测试用例）
- ✅ 异常处理体系

### 待实现功能
- ⏳ 代码生成器
- ⏳ CLI 工具（考虑是否需要）
- ⏳ 可视化工具
- ⏳ 更多内置验证规则

## 成功标准

1. ✅ AI 能够准确理解并生成符合 DSL 规范的 Agent 定义
2. ✅ 错误提示清晰明确，帮助快速定位和修复问题
3. ✅ 系统具有良好的可扩展性和维护性
4. ⏳ 生成的 Agent 能够正确执行预定义的任务（需要代码生成器）

## 项目状态

当前版本：0.0.0（初始开发版本）

### 已完成里程碑
- 基础架构搭建
- DSL 语法定义
- 核心解析和验证功能
- 测试框架和用例
- 文档框架

### 下一步计划
1. 完善 API 文档
2. 添加更多示例
3. 开发代码生成器
4. 考虑发布策略